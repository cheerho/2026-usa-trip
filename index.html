<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 USA Family Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { --earth-red: #A67B71; --earth-yellow: #D9B48F; --earth-bg: #F5F2EE; --text-main: #3D3530; --dark-slate: #334155; }
        body { font-family: -apple-system, sans-serif; background: var(--earth-bg); color: var(--text-main); }
        [x-cloak] { display: none !important; }
        .loading-screen { position: fixed; inset: 0; background: var(--earth-bg); z-index: 200; display: flex; align-items: center; justify-content: center; flex-direction: column; }
    </style>
</head>
<body x-data="travelApp()" x-init="init()">

    <div x-show="loading" class="loading-screen">
        <div class="animate-spin text-earth-red text-4xl mb-4"><i class="fas fa-circle-notch"></i></div>
        <p class="text-xs font-bold tracking-widest text-stone-400 uppercase">Synchronizing Data...</p>
    </div>

    <div x-show="!loading" x-cloak>
        <div class="relative h-64 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1436491865332-7a61a109c055?q=80&w=1200');">
            <div class="absolute inset-0 bg-stone-900/40"></div>
            <div class="absolute top-24 left-8 text-white">
                <h1 class="text-3xl font-black">2026 USA Trip<span class="text-xs opacity-40 ml-2">v15.5.1</span></h1>
                <p class="text-[9px] font-bold opacity-70 uppercase tracking-[0.4em] mt-2">Canyon Expedition</p>
            </div>
            <div class="absolute bottom-[-24px] right-6 flex gap-3">
                <button @click="currentTab = 'itinerary'" :class="currentTab==='itinerary'?'bg-earth-yellow text-white':'bg-white text-earth-red'" class="w-12 h-12 rounded-full shadow-lg transition-all"><i class="fas fa-map-marker-alt"></i></button>
                <button @click="currentTab = 'info'" :class="currentTab==='info'?'bg-earth-yellow text-white':'bg-white text-earth-red'" class="w-12 h-12 rounded-full shadow-lg transition-all"><i class="fas fa-plane"></i></button>
            </div>
        </div>

        <main class="p-6 mt-8 pb-32">
            <div x-show="currentTab === 'itinerary'">
                <div class="flex overflow-x-auto gap-3 mb-6 no-scrollbar pb-2">
                    <template x-for="d in dates">
                        <div @click="activeDate = d.full" :class="activeDate === d.full ? 'bg-earth-red text-white' : 'bg-white text-stone-400'" class="flex-shrink-0 w-16 py-3 rounded-2xl text-center shadow-sm cursor-pointer transition-all">
                            <div class="text-lg font-black" x-text="d.dayOnly"></div>
                            <div class="text-[9px] uppercase" x-text="d.weekday"></div>
                        </div>
                    </template>
                </div>

                <div class="space-y-6">
                    <template x-for="event in filteredEvents">
                        <div class="flex gap-4">
                            <div class="flex flex-col items-center w-12">
                                <span class="text-sm font-black" x-text="event.time"></span>
                                <div class="w-px h-full bg-stone-200 my-2"></div>
                            </div>
                            <div class="flex-1 bg-white p-4 rounded-2xl shadow-sm">
                                <h3 class="font-black text-stone-800" x-text="event.name"></h3>
                                <p class="text-xs text-stone-400 mt-1" x-text="event.note"></p>
                            </div>
                        </div>
                    </template>
                    
                    <template x-if="currentStay">
                        <div class="ml-12 mt-4 bg-dark-slate p-6 rounded-[28px] text-white shadow-xl relative">
                            <div class="text-[10px] text-earth-yellow font-black uppercase mb-2">Tonight's Stay</div>
                            <div class="text-lg font-black mb-2" x-text="currentStay.name"></div>
                            <div class="text-xs text-white/60 mb-4 text-justify" x-text="currentStay.desc"></div>
                            <a :href="currentStay.link" target="_blank" class="block w-full py-3 bg-earth-yellow text-white text-center rounded-xl font-bold text-sm">前往飯店網頁 / 導航</a>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="currentTab === 'info'" class="space-y-4">
                <template x-for="f in flightList">
                    <div class="bg-dark-slate p-6 rounded-[28px] text-white shadow-lg">
                        <div class="flex items-center gap-2 mb-4 border-b border-white/10 pb-3">
                            <img :src="f.logo" class="w-5 h-5 filter brightness-0 invert">
                            <span class="text-[10px] font-black tracking-widest uppercase text-earth-yellow" x-text="f.airline + ' • ' + f.no"></span>
                        </div>
                        <div class="flex justify-between items-center text-center">
                            <div class="text-left">
                                <div class="text-xl font-black" x-text="f.fromC"></div>
                                <div class="text-sm font-bold opacity-80" x-text="f.fromE + ' ' + f.fromT"></div>
                                <div class="text-lg font-bold text-earth-yellow mt-2" x-text="f.depT"></div>
                            </div>
                            <div class="flex-1 px-4 opacity-20 text-3xl">→</div>
                            <div class="text-right">
                                <div class="text-xl font-black" x-text="f.toC"></div>
                                <div class="text-sm font-bold opacity-80" x-text="f.toE + ' ' + f.toT"></div>
                                <div class="text-lg font-bold text-earth-yellow mt-2" x-text="f.arrT"></div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </main>
    </div>

    <script>
        function travelApp() {
            return {
                currentTab: 'itinerary',
                activeDate: '2026/05/03',
                loading: true,
                dates: [],
                events: [],
                flightList: [
                    { no: "UA872", airline: "United Airlines", logo: "https://www.united.com/favicon.ico", fromC: "台北", fromE: "TPE", fromT: "T2", toC: "舊金山", toE: "SFO", toT: "I", depT: "09:50", arrT: "06:25", dur: "11h 35m" },
                    { no: "UA2042", airline: "United Airlines", logo: "https://www.united.com/favicon.ico", fromC: "舊金山", fromE: "SFO", fromT: "T3", toC: "奧斯汀", toE: "AUS", toT: "Main", depT: "08:55", arrT: "14:27", dur: "3h 32m" },
                    { no: "UA18", airline: "United Airlines", logo: "https://www.united.com/favicon.ico", fromC: "奧斯汀", fromE: "AUS", fromT: "Main", toC: "台北", toE: "TPE", toT: "T2", depT: "14:10", arrT: "18:45", dur: "13h 35m" }
                ],
                async init() {
                    this.dates = this.generateDates();
                    await this.refreshAll();
                },
                generateDates() {
                    let dArr = [], s = new Date(2026, 4, 3), e = new Date(2026, 4, 18);
                    while(s <= e) {
                        dArr.push({ full: `${s.getFullYear()}/${String(s.getMonth()+1).padStart(2,'0')}/${String(s.getDate()).padStart(2,'0')}`, dayOnly: String(s.getDate()).padStart(2,'0'), weekday: ['SUN','MON','TUE','WED','THU','FRI','SAT'][s.getDay()] });
                        s.setDate(s.getDate() + 1);
                    }
                    return dArr;
                },
                get filteredEvents() { return this.events.filter(e => e.date === this.activeDate); },
                get currentStay() {
                    let last = [...this.filteredEvents].reverse().find(e => e.stay);
                    if (!last) return null;
                    let url = (last.stay.match(/https?:\/\/[^\s]+/g) || [])[0];
                    return { name: last.stay.split('http')[0].split('\n')[0], desc: last.stay.split('\n').slice(1).join(' ').replace(url,''), link: url || '#' };
                },
                async refreshAll() {
                    const url = `https://docs.google.com/spreadsheets/d/e/2PACX-1vTCDL1TfyD_VsfRPWQxEUovWSnLZmpUzAKrZr-ni7BIJ8DgrKWxPGRywUCv7Eu6j-rSbcdPZbG4kiX1/pub?gid=1750147690&single=true&output=csv&t=${Date.now()}`;
                    Papa.parse(url, {
                        download: true, header: true,
                        complete: (r) => {
                            let lastD = "";
                            this.events = r.data.map(row => {
                                let d = row.日期;
                                if (!d) d = lastD;
                                else { let p = d.match(/\d+/g); d = `2026/${p[0].padStart(2,'0')}/${p[1].padStart(2,'0')}`; lastD = d; }
                                return { date: d, time: row.時間, name: row.行程, note: row.備註, stay: row.住宿 };
                            });
                            this.loading = false;
                        },
                        error: () => { alert("資料讀取失敗，請檢查 Google Sheet 發佈設定"); this.loading = false; }
                    });
                }
            }
        }
    </script>
</body>
</html>
